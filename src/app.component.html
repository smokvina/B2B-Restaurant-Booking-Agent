<div class="flex flex-col h-screen max-w-4xl mx-auto bg-white shadow-2xl rounded-lg overflow-hidden dark:bg-[#1E1E1E] transition-colors duration-300">
  <!-- Header -->
  <header class="bg-gray-800 text-white p-4 flex items-center shadow-md dark:bg-black">
    <div class="w-12 h-12 bg-[#007BFF] rounded-full flex items-center justify-center mr-4">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8h2a2 2 0 012 2v6a2 2 0 01-2 2h-2v4l-4-4H9a2 2 0 01-2-2V4a2 2 0 012-2h8z" />
      </svg>
    </div>
    <div>
      <h1 class="text-xl font-bold">B2B Rezervacijski Agent</h1>
      <p class="text-sm text-gray-300">Va≈° partner za grupne rezervacije</p>
    </div>
    <div class="ml-auto">
      <button (click)="toggleTheme()" class="p-2 rounded-full text-gray-300 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-white">
        <span class="sr-only">Toggle theme</span>
        @if (theme() === 'dark') {
          <!-- Sun Icon -->
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1m8.66-15.66l-.707.707M4.04 19.96l-.707.707M21 12h-1M4 12H3m15.66 8.66l-.707-.707M4.04 4.04l-.707-.707" />
          </svg>
        } @else {
          <!-- Moon Icon -->
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
          </svg>
        }
      </button>
    </div>
  </header>

  <!-- Chat Messages -->
  <main #chatContainer class="flex-1 overflow-y-auto p-6 space-y-6 bg-[#F8F9FA] dark:bg-[#121212]">
    @for (message of messages(); track $index) {
      <div [class]="'flex ' + (message.role === 'user' ? 'justify-end' : 'justify-start')">
        <div [class]="'max-w-lg p-4 rounded-2xl shadow ' + (message.role === 'user' ? 'bg-[#007BFF] text-white rounded-br-none' : 'bg-white text-[#212529] rounded-bl-none border border-gray-200 dark:bg-[#1E1E1E] dark:text-[#E0E0E0] dark:border-gray-700')">
          @if (message.role === 'assistant' && !message.content && isLoading()) {
            <div class="flex items-center space-x-2">
              <div class="w-2 h-2 bg-gray-400 rounded-full animate-pulse"></div>
              <div class="w-2 h-2 bg-gray-400 rounded-full animate-pulse [animation-delay:0.2s]"></div>
              <div class="w-2 h-2 bg-gray-400 rounded-full animate-pulse [animation-delay:0.4s]"></div>
            </div>
          } @else {
            <div class="prose prose-sm max-w-none dark:prose-invert" [innerHTML]="parseAndSanitize(message.content)"></div>
          }
        </div>
      </div>
    }

    <!-- Language Selection Buttons -->
    @if (chatState() === 'language-select') {
      <div class="flex justify-center space-x-2 p-4">
        <button (click)="selectLanguage('Hrvatski')" class="px-4 py-2 bg-[#007BFF] text-white font-semibold rounded-lg hover:bg-blue-700 transition dark:bg-[#4D9FFF] dark:hover:bg-blue-500">Hrvatski</button>
        <button (click)="selectLanguage('English')" class="px-4 py-2 bg-gray-600 text-white font-semibold rounded-lg hover:bg-gray-700 transition dark:bg-gray-700 dark:hover:bg-gray-600">English</button>
        <button (click)="selectLanguage('German')" class="px-4 py-2 bg-gray-600 text-white font-semibold rounded-lg hover:bg-gray-700 transition dark:bg-gray-700 dark:hover:bg-gray-600">German</button>
        <button (click)="selectLanguage('Italian')" class="px-4 py-2 bg-gray-600 text-white font-semibold rounded-lg hover:bg-gray-700 transition dark:bg-gray-700 dark:hover:bg-gray-600">Italian</button>
      </div>
    }
  </main>

  <!-- Input Form -->
  <footer class="p-4 bg-white border-t border-gray-200 dark:bg-[#1E1E1E] dark:border-gray-700">
    <form (ngSubmit)="sendMessage()" class="flex items-center space-x-3">
      <input
        type="text"
        [(ngModel)]="userInput"
        name="userInput"
        placeholder="Unesite destinaciju, broj osoba..."
        [disabled]="isLoading() || chatState() === 'language-select'"
        class="flex-1 p-3 border border-gray-300 rounded-full focus:ring-2 focus:ring-[#007BFF] focus:outline-none transition bg-white dark:bg-gray-800 dark:border-gray-600 dark:text-[#E0E0E0] dark:placeholder-gray-400"
        autocomplete="off"
      />
      <button
        type="submit"
        [disabled]="isLoading() || !userInput().trim() || chatState() === 'language-select'"
        class="bg-[#007BFF] text-white rounded-full p-3 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#007BFF] disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors dark:bg-[#4D9FFF] dark:hover:bg-blue-500 dark:disabled:bg-gray-600"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
        </svg>
      </button>
    </form>
  </footer>
</div>